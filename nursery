#!/bin/sh
# Author: Shree Raj Shrestha
# Date: 01/28/2025
set -ueox pipefail
source ./rake "${1}"

function clear() {
    podman container stop "${1}" && true
    podman container rm --force "${1}"
}

if [[ $WHICH_SOIL =~ .*cob$ ]]; then
    clear "${WHICH_SOIL}"
    podman run -d --name "${WHICH_SOIL}" -v "${HUSK_HOME}":"${SOIL_HOME}":z -t "${WHICH_SOIL}" "${SOIL_HOME}/unshell" "${1}"
elif [[ $WHICH_SOIL =~ .*farm$ ]]; then
    clear "${WHICH_SOIL}"
    podman run -d --name "${WHICH_SOIL}" -v "${HUSK_HOME}":"${SOIL_HOME}":z -t "${WHICH_SOIL}" "${SOIL_HOME}/plant" "${1}"
elif [[ $WHICH_SOIL =~ .*empty$ ]]; then
    clear "${WHICH_SOIL}"
    podman run -d --name "${WHICH_SOIL}" -v "${HUSK_HOME}":"${SOIL_HOME}":z -t "${WHICH_SOIL}" "/bin/bash"
else
    echo "cannot nursery unsupported soil" && exit 1
fi
