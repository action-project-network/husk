#!/bin/sh
# Author: Shree Raj Shrestha
# Date: 01/20/2025
set -ueox pipefail
source /soil/rake "${1}"
mkdir -p "${WIP}"

source "${SOIL_HOME}/silo/seeds/$(echo "${2}" | cut -d "_" -f 1)/$(echo "${2}" | cut -d "_" -f 2).seed"
ARCHIVE=$(echo "${URL##*/}")
cd "${SOIL_HOME}/silo/seeds/$(echo "${2}" | cut -d "_" -f 1)/"
case $(echo "${ARCHIVE##*.}") in
    "bz2")
        tar -xvf "${ARCHIVE}" -C "${WIP}";;
    "gz")
        tar -xvzf "${ARCHIVE}" -C "${WIP}";;
    "zip")
        unzip "${ARCHIVE}" -d "${WIP}";;
    "git")
        tar -xvzf "${ARCHIVE}" -C "${WIP}";;
    *)
        exit 1 ;;
esac

WHICH_SEED="$(echo "${2}" | cut -d "_" -f 1)"
source "${SOIL_HOME}/silo/seeds/$(echo "${2}" | cut -d "_" -f 1)/$(echo "${2}" | cut -d "_" -f 3).recipe"
cd "${WIP}/${SOURCE}"
for STEP in "${STEPS[@]}"; do eval "${STEP}"; done
rm -rf "${WIP}"
